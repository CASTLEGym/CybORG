import argparse

from CybORG.Emulator.Actions.Velociraptor.ExploitAction import ExploitAction

def parseCmdLineArgs ():
    # parse the command line
    parser = argparse.ArgumentParser ()

    # add optional arguments
    parser.add_argument ("-host", "--hostname", default="cpswtjustin", help="Hostname, use hostname to figure out hostname")
    parser.add_argument ("-remote", "--remote_hostname", default="0.0.0.0", help="Remote IP Address")

    # parse the args
    args = parser.parse_args ()

    return args

if __name__ == "__main__":
    try: 
        parsed_args = parseCmdLineArgs ()
        
        # credentials_file = "/home/ubuntu/prog_client.yaml"
        credentials_file = "/home/ubuntu/justinyeh1995/CASTLEGym/CybORG/CybORG/Mininet/actions/prog_client.yaml"  # @To-Do make it configurable
        
        hostname = parsed_args.hostname
        remote_hostname = parsed_args.remote_hostname
        remote_username ="root"
        remote_password ="1234"
        
        client_port=4444
        server_port=22

        exploit_action=ExploitAction(credentials_file,hostname,remote_hostname,remote_username,remote_password,client_port,server_port)
            
        observation=exploit_action.execute(None)
        print("Success is:",observation.success)
        print("Connection Key is:",observation.connection_key)
        print("Malicious file written?:",observation.malicious_file_write)
        print("Exploit is:",observation.available_exploit)
        print("connection info string is:",observation.ip_address_info)
        print('Please clean the mess after test!!')
    
    except KeyboardInterrupt:
        print("Interrupted! Cleaning up before exiting.") 